import { LineEdit, ScrollView, VerticalBox, HorizontalBox, StandardButton, Button, ComboBox } from "std-widgets.slint";

export struct FileItem {
    id: int,
    name: string,
    path: string,
    size: int,
    modified_time: string,
    file_type: string,
}

export component AppWindow inherits Window {
    title: "File Search Tool";
    preferred-width: 800px;
    preferred-height: 600px;
    
    in-out property <[FileItem]> file-items: [];
    in-out property <string> search-text: "";
    in-out property <[string]> available-databases: [];
    in-out property <int> current-database-index: 0;
    
    callback search-requested(string);
    callback database-changed(int);
    
    VerticalBox {
        padding: 20px;
        spacing: 15px;
        
        // Êï∞ÊçÆÂ∫ìÈÄâÊã©Âô® - ‰ΩøÁî®‰∏ãÊãâÂàóË°®
        HorizontalBox {
            spacing: 10px;
            alignment: start;
            
            Text {
                text: "Database:";
                vertical-alignment: center;
                font-weight: 600;
                width: 80px;
            }
            
            // Êï∞ÊçÆÂ∫ì‰∏ãÊãâÈÄâÊã©Ê°Ü
            database-combo := ComboBox {
                width: 250px;
                model: root.available-databases;
                current-index: root.current-database-index;
            }
            
            // Âà∑Êñ∞Êï∞ÊçÆÂ∫ìÂàóË°®ÊåâÈíÆ
            Button {
                text: "üîÑ";
                clicked => {
                    // Ëß¶ÂèëÊï∞ÊçÆÂ∫ìÂàóË°®Âà∑Êñ∞
                    root.database-changed(-1); // -1 Ë°®Á§∫Âà∑Êñ∞ÂàóË°®
                }
            }
        }
        
        // ÊêúÁ¥¢Ê°Ü
        HorizontalBox {
            spacing: 10px;
            alignment: start;
            
            Text {
                text: "Search:";
                vertical-alignment: center;
                font-weight: 600;
                width: 80px;
            }
            
            search-input := LineEdit {
                width: 400px;
                placeholder-text: "Enter file name or path...";
                edited => {
                    root.search-text = self.text;
                    root.search-requested(root.search-text);
                }
                accepted => {
                    root.search-requested(root.search-text);
                }
            }
            
            Rectangle {
                width: 80px;
                height: 30px;
                background: #007acc;
                border-radius: 5px;
                
                TouchArea {
                    clicked => {
                        root.search-requested(root.search-text);
                    }
                }
                
                Text {
                    text: "Search";
                    color: white;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                    font-weight: 600;
                }
            }
        }
        
        // ÊêúÁ¥¢ÁªìÊûúÂàóË°®
        ScrollView {
            preferred-height: 100%;
            
            VerticalBox {
                spacing: 5px;
                
                if root.file-items.length == 0 : Text {
                    text: "No matching files found";
                    horizontal-alignment: center;
                    vertical-alignment: center;
                    opacity: 0.5;
                    height: 100px;
                }
                
                for file-item in root.file-items : Rectangle {
                    height: 60px;
                    background: #ffffff;
                    border-radius: 5px;
                    border-width: 1px;
                    border-color: #e0e0e0;
                    
                    TouchArea {
                        clicked => {
                            // ÁÆÄÂçïÁöÑÊñá‰ª∂ÈÄâÊã©Ôºå‰∏çÂåÖÂê´Âè≥ÈîÆËèúÂçïÂäüËÉΩ
                        }
                        
                        HorizontalBox {
                            padding: 10px;
                            spacing: 10px;
                            
                            Rectangle {
                                width: 40px;
                                height: 40px;
                                background: #007acc;
                                border-radius: 5px;
                                
                                Text {
                                    text: "üìÑ";
                                    font-size: 20px;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                    color: white;
                                }
                            }
                            
                            VerticalBox {
                                spacing: 5px;
                                
                                Text {
                                    text: file-item.name;
                                    font-size: 14px;
                                    font-weight: 600;
                                }
                                
                                Text {
                                    text: file-item.path;
                                    font-size: 12px;
                                    color: #666666;
                                    overflow: elide;
                                }
                                
                                HorizontalBox {
                                    spacing: 10px;
                                    
                                    Text {
                                        text: "Size: " + (file-item.size / 1024) + " KB";
                                        font-size: 11px;
                                        color: #888888;
                                    }
                                    
                                    Text {
                                        text: "Modified: " + file-item.modified_time;
                                        font-size: 11px;
                                        color: #888888;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
